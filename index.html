<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SafeSurf Kids • Spark Edition</title>
  <meta name="description" content="SafeSurf Kids: colorful lessons, quick quizzes, handy safety tools, Spark AI chat, and a fun runner game to learn safe ICT." />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;700;800;900&display=swap" rel="stylesheet" />
  <style>
    :root{
      --red:#E63946;        /* primary red */
      --red-dark:#C1121F;   /* deeper red */
      --yellow:#FFD166;     /* warm yellow */
      --ink:#1D1D1F;        /* text */
      --muted:#6B7280;      /* muted text */
      --white:#FFFFFF;
      --offwhite:#FFF8EE;
      --card:#FFFFFF;
      --shadow:0 14px 40px rgba(0,0,0,.12);
      --radius:16px;
    }

    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0; color:var(--ink);
      font-family:'Nunito',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 700px at -10% -20%, rgba(255,209,102,.25), transparent 60%),
        radial-gradient(1000px 600px at 110% -10%, rgba(230,57,70,.14), transparent 55%),
        var(--offwhite);
      line-height:1.45; scroll-behavior:smooth;
    }

    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}

    /* Header with animated gradient strip */
    header.site-header{
      position:sticky; top:0; z-index:1000;
      background:var(--white);
      box-shadow:0 8px 26px rgba(0,0,0,.08);
      border-bottom:4px solid var(--yellow);
    }
    .header-bar{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 18px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:56px;height:56px;border-radius:50%;
      background: conic-gradient(from 90deg, var(--red), var(--yellow), var(--red));
      display:grid;place-items:center;color:#fff;font-weight:900;
      box-shadow:0 10px 22px rgba(230,57,70,.35);
      animation:spinSoft 14s linear infinite;
    }
    .logo span{filter:drop-shadow(0 2px 4px rgba(0,0,0,.35))}
    @keyframes spinSoft{
      0%{transform:rotate(0)}
      100%{transform:rotate(360deg)}
    }
    .title{margin:0;font-weight:900;letter-spacing:.3px}
    .tagline{margin:2px 0 0;color:var(--muted);font-weight:800}

    .header-actions{display:flex;align-items:center;gap:14px}
    .progress{
      display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;
      background:#FFF3F3;border:2px solid #FFE0E0;font-weight:900;color:var(--red-dark)
    }
    .progress-ring{
      --size:42px;width:var(--size);height:var(--size);border-radius:50%;
      background:
        conic-gradient(var(--red) var(--angle,0%), rgba(255,255,255,.6) 0),
        radial-gradient(circle at 50% 50%, #fff 64%, transparent 66%);
      display:grid;place-items:center;font-size:12px;color:#7a161c;box-shadow:inset 0 0 0 3px #fff
    }

    .lang select{
      border:2px solid #FFE3A1;background:#fff;border-radius:999px;padding:6px 10px;font-weight:900
    }

    /* Nav */
    nav.main-nav{
      display:flex;gap:10px;flex-wrap:wrap;padding:10px 16px;background:#fff;border-top:1px dashed #FFE3A1
    }
    .nav-btn{
      appearance:none;border:0;border-radius:999px;padding:10px 16px;font-weight:900;cursor:pointer;
      color:#7a161c;background:var(--yellow);
      box-shadow:0 6px 14px rgba(255,209,102,.35);
      transition:transform .08s ease, box-shadow .2s ease, background .2s ease
    }
    .nav-btn:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(255,209,102,.5)}
    .nav-btn.active{background:var(--red);color:#fff;box-shadow:0 10px 22px rgba(230,57,70,.35)}
    .nav-btn:focus-visible{outline:3px solid var(--red-dark)}

    main{max-width:1150px;margin:0 auto;padding:22px 14px 100px}
    .view{display:none}
    .view.active{display:block}

    /* Hero */
    .hero{
      position:relative;overflow:hidden;isolation:isolate;
      background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:26px
    }
    .hero::after{
      content:"";position:absolute;right:-120px;top:-120px;width:300px;height:300px;border-radius:50%;
      background:radial-gradient(closest-side, rgba(255,209,102,.4), transparent 70%);
      filter:blur(18px);animation:pulse 6s ease-in-out infinite
    }
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    .cta{
      display:inline-block;margin-top:12px;margin-right:10px;text-decoration:none;font-weight:900;
      padding:12px 16px;border-radius:12px;color:#7a161c;background:var(--yellow);
      box-shadow:0 10px 20px rgba(255,209,102,.4);
      transition:transform .1s ease, box-shadow .2s ease
    }
    .cta:hover{transform:translateY(-2px);box-shadow:0 14px 28px rgba(255,209,102,.55)}
    .cta.secondary{background:var(--red);color:#fff;box-shadow:0 10px 22px rgba(230,57,70,.35)}

    /* Grid cards */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-top:16px}
    .card{
      background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;position:relative;overflow:hidden;
      transition:transform .08s ease, box-shadow .2s ease, background .2s ease
    }
    .card::before{
      content:"";position:absolute;inset:-40% auto auto -40%;width:180px;height:180px;border-radius:50%;
      background:radial-gradient(closest-side, rgba(230,57,70,.07), transparent 70%);transform:rotate(18deg)
    }
    .card:hover{transform:translateY(-3px);box-shadow:0 18px 38px rgba(0,0,0,.18)}

    .muted{color:var(--muted)}
    .tiny{font-size:.92rem}

    /* Learn */
    .module-detail{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin-top:16px}

    /* Tools zone */
    .tools{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .tool{background:#fff;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .tool h4{margin:.2rem 0 .6rem}
    .toggle{display:flex;align-items:center;gap:10px;margin:.3rem 0}
    .toggle input{accent-color:var(--red)}

    /* Flashcards */
    .flash{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .flip{
      position:relative;perspective:800px;height:120px;cursor:pointer
    }
    .flip > div{
      position:absolute;inset:0;border-radius:12px;display:grid;place-items:center;padding:10px;
      backface-visibility:hidden;transition:transform .5s;box-shadow:var(--shadow)
    }
    .flip .front{background:#fff5f5;border:2px solid #ffd0d0}
    .flip .back{background:#fffbe8;border:2px solid #ffe9a8;transform:rotateY(180deg)}
    .flip.active .front{transform:rotateY(180deg)}
    .flip.active .back{transform:rotateY(360deg)}

    /* Chat */
    .safety{background:#fff7df;border:2px dashed var(--yellow);padding:12px;border-radius:12px;margin:8px 0;font-weight:900}
    .age{display:flex;gap:12px;align-items:center;font-weight:900}
    .chat{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .chat-log{max-height:420px;min-height:240px;overflow:auto;padding:16px;background:linear-gradient(180deg,#fff,#fffdf7)}
    .bubble{display:inline-block;padding:10px 12px;border-radius:14px;margin:8px 0;max-width:80%;line-height:1.45;animation:fadeIn .18s ease}
    .bubble.user{background:var(--red);color:#fff;border-bottom-right-radius:4px}
    .bubble.spark{background:#fff; border:2px solid var(--yellow); color:#7a161c; border-bottom-left-radius:4px}
    @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    .chat-form{display:flex;gap:10px;border-top:1px solid #f2e9da;padding:12px}
    .chat-form input{flex:1;padding:12px 14px;border-radius:12px;border:2px solid #f0d9a1}
    .chat-form input:focus-visible{outline:none;border-color:var(--red)}
    .send{background:var(--yellow);color:#7a161c;border:0;border-radius:12px;font-weight:900;padding:12px 16px;cursor:pointer;box-shadow:0 8px 16px rgba(255,209,102,.35)}
    .typing{display:inline-flex;gap:3px}
    .typing span{width:6px;height:6px;border-radius:999px;background:#7a161c;opacity:.35;animation:blink 1s infinite}
    .typing span:nth-child(2){animation-delay:.15s}.typing span:nth-child(3){animation-delay:.3s}
    @keyframes blink{50%{opacity:1}}

    /* Game */
    .game-wrap{display:grid;grid-template-columns:1.4fr .9fr;gap:16px}
    .game-card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:12px}
    canvas#runner{width:100%;height:260px;background:linear-gradient(#fff, #fffef6);border:2px solid #ffe5a6;border-radius:12px}
    .hud{display:flex;justify-content:space-between;gap:10px;margin:8px 0;font-weight:900}
    .btn{background:var(--red);color:#fff;border:0;border-radius:10px;padding:10px 12px;font-weight:900;cursor:pointer;box-shadow:0 8px 18px rgba(230,57,70,.35)}
    .btn.secondary{background:var(--yellow);color:#7a161c;box-shadow:0 8px 18px rgba(255,209,102,.4)}
    .pill{display:inline-block;background:#fff3f3;border:2px solid #ffd0d0;color:#7a161c;border-radius:999px;padding:4px 8px;font-weight:900}

    /* Reveal */
    .reveal{opacity:0;transform:translateY(10px);transition:all .5s ease}
    .reveal.show{opacity:1;transform:translateY(0)}

    footer{padding:26px 12px;text-align:center;color:var(--muted)}
    #confetti{pointer-events:none;position:fixed;inset:0}
    .confetti{position:absolute;font-size:18px;filter:drop-shadow(0 4px 8px rgba(0,0,0,.12));animation:fall 1.8s ease-out forwards}
    @keyframes fall{0%{transform:translateY(-20px) rotate(0);opacity:0}15%{opacity:1}100%{transform:translateY(92vh) rotate(260deg);opacity:0}}
    @media (max-width:900px){.game-wrap{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-bar">
      <div class="brand">
        <div class="logo" aria-hidden="true"><span>SS</span></div>
        <div>
          <h1 class="title">SafeSurf Kids</h1>
          <p class="tagline">Learn smart, safe, and kind ICT 💛</p>
        </div>
      </div>

      <div class="header-actions">
        <div class="progress" aria-live="polite" title="Your progress">
          <div class="progress-ring" id="progressRing"><span id="progressPct">0%</span></div>
          <span>Stars:</span><strong id="stars">0</strong>
        </div>
        <div class="lang">
          <label for="langSel" class="visually-hidden">Language</label>
          <select id="langSel">
            <option value="en" selected>EN</option>
            <option value="es">ES</option>
          </select>
        </div>
      </div>
    </div>

    <nav class="main-nav" aria-label="Main">
      <button class="nav-btn active" data-target="home">Home</button>
      <button class="nav-btn" data-target="learn">Learn</button>
      <button class="nav-btn" data-target="tools">Tools</button>
      <button class="nav-btn" data-target="ask">Ask Spark</button>
      <button class="nav-btn" data-target="game">Game</button>
      <button class="nav-btn" data-target="parents">Parents</button>
      <button class="nav-btn" data-target="resources">Resources</button>
    </nav>
  </header>

  <main>
    <!-- Home -->
    <section id="home" class="view active" aria-labelledby="home-h">
      <div class="hero reveal">
        <h2 id="home-h">Welcome! 🌈</h2>
        <p class="muted">Quick lessons, playful tools, a friendly AI helper, and a fun game — all about staying safe with ICT.</p>
        <a href="#learn" class="cta" data-go="learn">Start Learning</a>
        <a href="#ask" class="cta secondary" data-go="ask">Ask Spark</a>
      </div>

      <div class="grid" role="list">
        <article class="card reveal" role="listitem" tabindex="0">
          <h3>🔐 Strong Passwords</h3>
          <p>Use long, secret passwords. Turn on 2FA!</p>
        </article>
        <article class="card reveal" role="listitem" tabindex="0">
          <h3>🎣 Spot Scams</h3>
          <p>Check links. Don’t share logins. Ask an adult.</p>
        </article>
        <article class="card reveal" role="listitem" tabindex="0">
          <h3>💬 Be Kind Online</h3>
          <p>Block/report meanness. Save evidence. Talk to an adult.</p>
        </article>
        <article class="card reveal" role="listitem" tabindex="0">
          <h3>👣 Digital Footprints</h3>
          <p>Think before you post; the internet remembers.</p>
        </article>
      </div>
    </section>

    <!-- Learn -->
    <section id="learn" class="view" aria-labelledby="learn-h">
      <h2 id="learn-h" class="reveal">Learn: Safety Modules</h2>
      <p class="muted reveal">Tap a card to read tips, try a scenario, and take a quick quiz.</p>
      <div id="modules" class="grid" role="list"></div>
      <div id="moduleDetail" class="module-detail reveal" hidden aria-live="polite"></div>
    </section>

    <!-- Tools -->
    <section id="tools" class="view" aria-labelledby="tools-h">
      <h2 id="tools-h" class="reveal">Tools & Activities</h2>
      <div class="tools">
        <!-- Checklist -->
        <div class="tool reveal">
          <h3>✅ Safety Checklist</h3>
          <div class="toggle"><input type="checkbox" id="t1"><label for="t1">I use long passwords (12+)</label></div>
          <div class="toggle"><input type="checkbox" id="t2"><label for="t2">I turned on 2FA</label></div>
          <div class="toggle"><input type="checkbox" id="t3"><label for="t3">My profiles are private</label></div>
          <div class="toggle"><input type="checkbox" id="t4"><label for="t4">I don’t post location</label></div>
          <div class="toggle"><input type="checkbox" id="t5"><label for="t5">I block/report unkind messages</label></div>
          <p class="tiny muted" id="checkComplete"></p>
        </div>

        <!-- Flashcards -->
        <div class="tool reveal">
          <h3>🧠 Flashcards: Do / Don’t</h3>
          <div class="flash">
            <div class="flip"><div class="front">Share strong passwords?</div><div class="back">Don’t share passwords — keep them secret 🔐</div></div>
            <div class="flip"><div class="front">Click weird prize links?</div><div class="back">Don’t click — likely scams 🎣</div></div>
            <div class="flip"><div class="front">Ask before posting friends?</div><div class="back">Yes — ask permission 📸</div></div>
            <div class="flip"><div class="front">Be kind in comments?</div><div class="back">Yes — kindness first 💛</div></div>
          </div>
        </div>

        <!-- Password sandbox -->
        <div class="tool reveal">
          <h3>🔐 Password Sandbox</h3>
          <p class="tiny muted">Try a pretend password (don’t use a real one).</p>
          <input id="pw" type="text" placeholder="Type a pretend password…" style="width:100%;padding:10px;border-radius:10px;border:2px solid #ffd9d9">
          <p class="tiny"><strong>Strength:</strong> <span id="pwOut">–</span></p>
          <p class="tiny muted">Tip: 3 random words + numbers/symbols = strong!</p>
        </div>

        <!-- Phishing spotter -->
        <div class="tool reveal">
          <h3>🎣 Phishing Spotter</h3>
          <p class="tiny">Is this message safe?</p>
          <blockquote style="background:#fffef2;border-left:6px solid var(--yellow);padding:8px;border-radius:8px">“URGENT! Free phone! Click this link and log in now.”</blockquote>
          <button class="btn secondary" id="phishBtn">Check</button>
          <p id="phishOut" class="tiny muted"></p>
        </div>
      </div>
    </section>

    <!-- Ask Spark -->
    <section id="ask" class="view" aria-labelledby="ask-h">
      <h2 id="ask-h" class="reveal">Ask Spark (AI)</h2>
      <div class="safety reveal">Never share your real name, address, phone, school, or passwords.</div>
      <div class="age reveal">
        <label><input type="radio" name="age" value="8-10" checked> 8–10</label>
        <label><input type="radio" name="age" value="11-13"> 11–13</label>
      </div>

      <div class="chat reveal">
        <div id="chatLog" class="chat-log" role="log" aria-live="polite" aria-relevant="additions"></div>
        <form id="chatForm" class="chat-form" autocomplete="off">
          <label for="chatInput" class="visually-hidden">Your message</label>
          <input id="chatInput" type="text" minlength="1" maxlength="600" placeholder="Ask me about staying safe online!" required />
          <button class="send" type="submit">Send</button>
        </form>
        <p class="tiny muted">We don’t store chats. Keep info private.</p>
      </div>
    </section>

    <!-- Game -->
    <section id="game" class="view" aria-labelledby="game-h">
      <h2 id="game-h" class="reveal">Runner Game: Dodge the Bad Stuff!</h2>
      <div class="game-wrap">
        <div class="game-card reveal">
          <div class="hud">
            <div>Score: <span id="score">0</span></div>
            <div>High: <span id="hi">0</span></div>
            <div>Lives: <span id="lives">3</span></div>
          </div>
          <canvas id="runner" width="800" height="260" aria-label="Runner game"></canvas>
          <div class="hud">
            <button class="btn" id="startBtn">Start</button>
            <button class="btn secondary" id="pauseBtn">Pause</button>
            <button class="btn secondary" id="resetBtn">Reset</button>
            <div class="pill">Jump: Space/↑</div>
          </div>
        </div>
        <div class="game-card reveal">
          <h3>How to play</h3>
          <ul>
            <li>Press Space or ↑ to jump over bad ICT obstacles: 🎣 (phishing), 😡 (bullying), 🔗 (weird links), 📸 (oversharing).</li>
            <li>Collect ⭐ stars for points.</li>
            <li>3 lives. Speed gets faster. Beat your high score!</li>
          </ul>
          <h4>Safety tips you’ll see</h4>
          <ul class="tiny">
            <li>Never share passwords, address, phone, or school.</li>
            <li>Don’t click strange links or prizes.</li>
            <li>Be kind online. Block and report meanness.</li>
            <li>Ask a trusted adult if unsure.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Parents -->
    <section id="parents" class="view" aria-labelledby="parents-h">
      <h2 id="parents-h" class="reveal">Parent & Carer Corner</h2>
      <div class="grid">
        <article class="card reveal">
          <h3>Quick Tips</h3>
          <ul>
            <li>Talk early and often about online kindness and privacy.</li>
            <li>Set clear, shared rules (no devices in bedrooms at night).</li>
            <li>Use family accounts and enable parental controls where helpful.</li>
            <li>Play/learn the apps together; keep dialogue open.</li>
            <li>Use strong passwords & 2FA; keep devices updated.</li>
          </ul>
        </article>
        <article class="card reveal">
          <h3>Conversation Starters</h3>
          <ul>
            <li>How do you decide what to share online?</li>
            <li>What would you do if someone asked for private info?</li>
            <li>Which creators make you feel good? Why?</li>
          </ul>
        </article>
        <article class="card reveal">
          <h3>Signs to Watch</h3>
          <ul>
            <li>Worry about going online, mood shifts.</li>
            <li>Secret new accounts or hiding screens.</li>
            <li>Unexpected charges or “new friends”.</li>
          </ul>
        </article>
      </div>
    </section>

    <!-- Resources -->
    <section id="resources" class="view" aria-labelledby="resources-h">
      <h2 id="resources-h" class="reveal">Resources</h2>
      <div class="grid">
        <article class="card reveal">
          <h3>If you need help</h3>
          <ul>
            <li>Talk to a trusted adult (parent, carer, teacher, counselor).</li>
            <li>If you are in danger, contact local emergency services right away.</li>
            <li>Use app/game “Report” and “Block”.</li>
          </ul>
        </article>
        <article class="card reveal">
          <h3>Helpful links</h3>
          <ul>
            <li><a href="https://www.childline.org.uk" target="_blank" rel="noopener">Childline (UK)</a></li>
            <li><a href="https://www.kidshelpphone.ca" target="_blank" rel="noopener">Kids Help Phone (CA)</a></li>
            <li><a href="https://www.stopbullying.gov" target="_blank" rel="noopener">StopBullying.gov (US)</a></li>
            <li><a href="https://www.commonsensemedia.org" target="_blank" rel="noopener">Common Sense Media</a></li>
          </ul>
          <p class="tiny muted">Links are examples — find local help in your area.</p>
        </article>
      </div>
    </section>
  </main>

  <div id="confetti" aria-hidden="true"></div>
  <footer>© <span id="year"></span> SafeSurf Kids · <span class="tiny">We don’t collect personal data.</span></footer>

  <script>
    // ===== Config (unchanged; uses your Worker) =====
    const USE_BACKEND = true;
    const BACKEND_URL = 'https://spark-ai-sethu.sethu-spark.workers.dev';

    // ===== Helpers & State =====
    const $ = (s, c=document) => c.querySelector(s);
    const $$ = (s, c=document) => Array.from(c.querySelectorAll(s));

    let completed = new Set(JSON.parse(localStorage.getItem('ss-completed')||'[]'));
    let ageGroup = '8-10';

    $('#year').textContent = new Date().getFullYear();

    // Nav switching
    $$('.nav-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id = btn.dataset.target;
        $$('.view').forEach(v=>v.classList.toggle('active', v.id===id));
        $$('.nav-btn').forEach(b=>b.classList.toggle('active', b===btn));
        window.scrollTo({top:0,behavior:'smooth'});
      });
    });
    $$('[data-go]').forEach(a=>a.addEventListener('click',e=>{
      e.preventDefault();
      const id=a.getAttribute('data-go');
      document.querySelector(`.nav-btn[data-target="${id}"]`).click();
    }));

    // Reveal animations
    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>e.target.classList.toggle('show', e.isIntersecting));
    },{threshold:.12});
    $$('.reveal').forEach(el=>io.observe(el));

    // Strings (EN/ES)
    const STR = {
      en:{},
      es:{}
    };
    $('#langSel').addEventListener('change', (e)=>{
      // Minimal demo switching; content already readable in EN
      document.documentElement.lang = e.target.value;
    });

    // ===== Lessons =====
    const LESSONS = [
      { id:'passwords',emoji:'🔐',title:'Strong Passwords & 2FA',subtitle:'Make your accounts tough to crack!',
        tips:[
          'Use long passwords (12+). Try three random words.',
          'Never share passwords with friends.',
          'Use a different password for each account.',
          'Turn on 2FA — a code from an app or text.',
          'Keep devices locked with a PIN or passcode.'
        ],
        scenario:{ prompt:'A message says: “Your account is locked! Send your password to fix it.” What do you do?',
          choices:[
            {text:'Send my password to unlock it', feedback:'Nope! Never share passwords. This is likely a scam.'},
            {text:'Ignore and go to the official app/website', feedback:'Yes! Use the real app/website and change your password if worried.'},
            {text:'Ask friends if they got the same message', feedback:'Better to check the official site instead of asking friends.'}
          ]
        },
        quiz:[
          {q:'What makes a strong password?', options:['Your name + birthday','12+ characters with random words','12345678'], answerIndex:1},
          {q:'What is 2FA?', options:['A gaming level','A code to prove it’s you','An emoji'], answerIndex:1},
          {q:'Should you share passwords?', options:['Yes','No'], answerIndex:1}
        ]
      },
      { id:'privacy',emoji:'🛡️',title:'Privacy & Sharing',subtitle:'Think before you post.',
        tips:[
          'Keep real name, address, phone, and school private.',
          'Turn off location sharing.',
          'Check privacy settings for posts and profiles.',
          'Ask before sharing photos of friends.',
          'Be kind — your future self will thank you!'
        ],
        scenario:{ prompt:'A new friend asks for your address to send a gift. What do you do?',
          choices:[
            {text:'Share it in chat', feedback:'Not safe. Never share your home address online.'},
            {text:'Say no and ask a trusted adult', feedback:'Great choice! Keep private info safe and talk to an adult.'},
            {text:'Give a nearby place instead', feedback:'Still risky. Don’t share locations online.'}
          ]
        },
        quiz:[
          {q:'What info should stay private?', options:['Real name & address','Favorite color'], answerIndex:0},
          {q:'Ask before posting a group photo?', options:['No','Yes — ask them'], answerIndex:1},
          {q:'Location sharing?', options:['Always on','Turn it off unless needed'], answerIndex:1}
        ]
      },
      { id:'cyberbullying',emoji:'💬',title:'Cyberbullying',subtitle:'Be kind, block, and report.',
        tips:[
          'If someone is unkind, don’t reply. Save evidence.',
          'Use block and report — it’s safety.',
          'Talk to a trusted adult right away.',
          'Be kind when you comment and message.',
          'Check in on friends who seem down.'
        ],
        scenario:{ prompt:'Someone keeps sending mean messages in a group chat. What now?',
          choices:[
            {text:'Send mean messages back', feedback:'This can make it worse. Don’t reply.'},
            {text:'Block, report, and tell a trusted adult', feedback:'That’s right! Block/report and talk to an adult.'},
            {text:'Leave the group and never tell anyone', feedback:'Leaving can help, but also tell a trusted adult.'}
          ]
        },
        quiz:[
          {q:'Keep as evidence?', options:['Screenshots','Nothing'], answerIndex:0},
          {q:'Who can you talk to?', options:['A trusted adult','No one'], answerIndex:0},
          {q:'Apps can help you…', options:['Block/report','Be mean back'], answerIndex:0}
        ]
      },
      { id:'scams',emoji:'🕵️',title:'Scams & Phishing',subtitle:'Spot tricks before they get you.',
        tips:[
          'Don’t click strange links or attachments.',
          'Check the sender — fakes look similar.',
          'Look for urgent threats & spelling mistakes.',
          'Use the official app/website to check accounts.',
          'Ask an adult if anything feels off.'
        ],
        scenario:{ prompt:'You win a “free phone” if you click a link. It asks for your login. What now?',
          choices:[
            {text:'Enter my login to get the prize', feedback:'This is a phishing trick. Don’t share logins.'},
            {text:'Close it and tell a trusted adult', feedback:'Good move! Stay safe and double-check with an adult.'},
            {text:'Click the link but don’t type anything', feedback:'Even clicking can be risky. Better to close it.'}
          ]
        },
        quiz:[
          {q:'Which looks suspicious?', options:['Weird links & urgent prizes','A message from your parent'], answerIndex:0},
          {q:'Where to check your account?', options:['Official app/website','Random link'], answerIndex:0},
          {q:'Who can help if unsure?', options:['Trusted adult','A stranger online'], answerIndex:0}
        ]
      },
      { id:'gaming',emoji:'🎮',title:'Gaming Safety & Screen Time',subtitle:'Play fun, play fair, take breaks.',
        tips:[
          'Use family-friendly chats and block rude players.',
          'Ask before buying in-game items.',
          'Take eye-and-body breaks every 30–60 mins.',
          'Don’t share private info in voice chat.',
          'Balance games with sleep, school, and friends.'
        ],
        scenario:{ prompt:'A player asks for your login to “boost” your account. What do you do?',
          choices:[
            {text:'Share it — I want better items', feedback:'Nope! Never share logins. They could steal your account.'},
            {text:'Say no, block, and report', feedback:'Perfect. Protect your account and move on.'},
            {text:'Share only the password', feedback:'That’s the most secret part. Keep it private!'}
          ]
        },
        quiz:[
          {q:'Breaks?', options:['Every 30–60 mins','Never'], answerIndex:0},
          {q:'In‑app purchases?', options:['Ask a parent first','Buy anything'], answerIndex:0},
          {q:'Keep private in voice chat?', options:['Address & school','Game tips'], answerIndex:0}
        ]
      },
      { id:'footprints',emoji:'👣',title:'Digital Footprints',subtitle:'What you post can last.',
        tips:[
          'Posts can travel fast and be saved.',
          'Be proud of what future‑you will see.',
          'Think: Kind? True? Needed?',
          'Ask before posting others.',
          'Review old posts and clean up.'
        ],
        scenario:{ prompt:'You find a silly video of your friend and want to post it. What now?',
          choices:[
            {text:'Post it — it’s funny!', feedback:'It could hurt feelings. Always ask first.'},
            {text:'Ask your friend if it’s okay', feedback:'Yes! Get permission before posting.'},
            {text:'Post now, remove later', feedback:'It might be copied. Better to ask first.'}
          ]
        },
        quiz:[
          {q:'Digital footprint is…', options:['Your shoe size','Your online posts/actions'], answerIndex:1},
          {q:'Share group pics?', options:['No ask','Ask people in photo'], answerIndex:1},
          {q:'Do deleted posts vanish?', options:['Always','Not always: others can save'], answerIndex:1}
        ]
      },
      { id:'ai',emoji:'🧠',title:'AI, Photos & Deepfakes',subtitle:'Not everything is real.',
        tips:[
          'Weird videos may be AI‑made.',
          'Check trusted news or official pages.',
          'Look for odd eyes, lighting, or lips.',
          'Don’t share shocking clips before checking.',
          'Ask an adult if unsure.'
        ],
        scenario:{ prompt:'A video shows your favorite creator saying something rude. It looks off. What do you do?',
          choices:[
            {text:'Share it fast!', feedback:'Wait! It could be fake. Don’t spread it.'},
            {text:'Check their official page', feedback:'Smart! Verify first.'},
            {text:'Post a rude comment', feedback:'Be kind — verify first.'}
          ]
        },
        quiz:[
          {q:'Deepfake is…', options:['A cookie','A realistic fake made with AI'], answerIndex:1},
          {q:'Share shocking clips quickly?', options:['Yes','No — check first'], answerIndex:1},
          {q:'If unsure…', options:['Ask an adult','Guess'], answerIndex:0}
        ]
      },
      { id:'social',emoji:'📱',title:'Smart Social Sharing',subtitle:'Share happy, share wisely.',
        tips:[
          'Use private accounts if possible.',
          'Hide personal info from profiles.',
          'Turn off location on posts.',
          'Be kind in comments and messages.',
          'Report fake or rude accounts.'
        ],
        scenario:{ prompt:'An app asks to access your contacts and location. What now?',
          choices:[
            {text:'Allow everything', feedback:'Only allow what you need.'},
            {text:'Allow only needed or say no', feedback:'Nice! Keep info safe.'},
            {text:'Share your password too', feedback:'Never share passwords.'}
          ]
        },
        quiz:[
          {q:'Safer for kids?', options:['Public','Private'], answerIndex:1},
          {q:'Share location?', options:['Always','Only if needed'], answerIndex:1},
          {q:'Rude person?', options:['Be rude back','Block/report & tell adult'], answerIndex:1}
        ]
      },
      { id:'devices',emoji:'🔧',title:'Device & Wi‑Fi Safety',subtitle:'Keep tech healthy.',
        tips:[
          'Update apps and system often.',
          'Use secure Wi‑Fi; avoid unknown public Wi‑Fi for logins.',
          'Don’t install random files.',
          'Use PIN/biometrics to lock your device.',
          'Ask an adult before changing settings.'
        ],
        scenario:{ prompt:'You’re on free public Wi‑Fi. A site asks for your login. What do you do?',
          choices:[
            {text:'Log in now', feedback:'Public Wi‑Fi can be risky. Avoid logins there.'},
            {text:'Wait and log in at home/data', feedback:'Great choice — stay safe!'},
            {text:'Download a random “security” app', feedback:'Only install trusted apps.'}
          ]
        },
        quiz:[
          {q:'Updates?', options:['Ignore','Install'], answerIndex:1},
          {q:'Public Wi‑Fi is…', options:['Always safe','Risky for logins'], answerIndex:1},
          {q:'Best phone lock?', options:['No lock','PIN/biometrics'], answerIndex:1}
        ]
      }
    ];

    function renderModules(){
      const wrap = $('#modules'); wrap.innerHTML='';
      LESSONS.forEach(m=>{
        const card = document.createElement('button');
        card.className='card reveal'; card.setAttribute('role','listitem');
        card.innerHTML = `<h3>${m.emoji} ${m.title}</h3><p class="muted">${m.subtitle}</p>
          <div class="tiny">${m.tips.slice(0,3).map(t=>'• '+t).join('<br>')}</div>`;
        io.observe(card);
        card.addEventListener('click', ()=>openModule(m.id));
        wrap.appendChild(card);
      });
      updateProgress();
    }

    function openModule(id){
      const m = LESSONS.find(x=>x.id===id); const box = $('#moduleDetail'); if(!m) return;
      box.hidden=false; window.location.hash = `#module-${id}`;
      const done = completed.has(id);
      box.innerHTML = `
        <div><h3>${m.emoji} ${m.title}</h3><p class="muted">${m.subtitle}</p></div>
        <div class="tips">
          <h4>Top Tips</h4><ul>${m.tips.map(t=>`<li>${t}</li>`).join('')}</ul>
        </div>
        <div class="scenario">
          <h4>Try a Scenario</h4>
          <p>${m.scenario.prompt}</p>
          <div class="grid">
            ${m.scenario.choices.map((c,i)=>`<button class="btn secondary" data-choice="${i}">${c.text}</button>`).join('')}
          </div>
          <p id="scOut" class="tiny muted" aria-live="polite"></p>
        </div>
        <div class="quiz">
          <h4>Quick Quiz</h4>
          <form id="q-${id}">
            ${m.quiz.map((q,qi)=>`
              <fieldset class="card" style="padding:12px">
                <legend><strong>${qi+1}.</strong> ${q.q}</legend>
                ${q.options.map((opt,oi)=>`
                  <label><input type="radio" name="q${qi}" value="${oi}" required> ${opt}</label><br>
                `).join('')}
              </fieldset>
            `).join('')}
            <button class="cta" type="submit">Check Answers</button>
          </form>
          <p id="qr" class="muted" aria-live="polite"></p>
          <div class="tiny">${done?'✅ Quiz completed — star awarded!':''}</div>
        </div>
      `;
      $$('.scenario .btn', box).forEach(b=>{
        b.addEventListener('click',()=>{
          const i=Number(b.dataset.choice); $('#scOut',box).textContent = m.scenario.choices[i].feedback;
        });
      });
      $('#q-'+id, box).addEventListener('submit',(e)=>{
        e.preventDefault();
        const data = new FormData(e.target); let correct=0;
        m.quiz.forEach((q,qi)=>{ const v=data.get('q'+qi); if(v!==null && Number(v)===q.answerIndex) correct++; });
        const qr = $('#qr', box);
        if(correct===m.quiz.length){
          qr.textContent=`Great job! You got ${correct}/${m.quiz.length} 🎉`;
          if(!completed.has(id)){
            completed.add(id); localStorage.setItem('ss-completed', JSON.stringify([...completed]));
            updateStars(); confetti(); updateProgress();
          }
        }else{
          qr.textContent=`You got ${correct}/${m.quiz.length}. Try again — you can do it! 💪`;
        }
      });
    }

    function updateStars(){ $('#stars').textContent = String(completed.size); }
    function updateProgress(){
      const pct = Math.round((completed.size / LESSONS.length)*100);
      const ring = $('#progressRing'); $('#progressPct').textContent = pct+'%';
      ring.style.setProperty('--angle', pct+'%');
    }

    // ===== Tools logic =====
    // Checklist
    $$('#tools .toggle input').forEach(inp=>{
      inp.addEventListener('change', ()=>{
        const done = $$('#tools .toggle input').filter(i=>i.checked).length;
        $('#checkComplete').textContent = done>=5 ? 'Awesome! You checked all safety steps. ⭐' : `${done}/5 done — keep going!`;
      });
    });
    // Flashcards
    $$('.flip').forEach(f=>f.addEventListener('click',()=>f.classList.toggle('active')));
    // Password sandbox
    $('#pw').addEventListener('input',e=>{
      const v=e.target.value;
      const score = pwStrength(v);
      const words = ['Very Weak','Weak','Okay','Good','Strong','Very Strong'];
      $('#pwOut').textContent = words[Math.min(words.length-1, score)];
    });
    function pwStrength(p){
      let s=0;
      if(p.length>=8) s++; if(p.length>=12) s++;
      if(/[A-Z]/.test(p)) s++; if(/[0-9]/.test(p)) s++; if(/[^A-Za-z0-9]/.test(p)) s++;
      if(/\b(password|1234|qwerty|admin)\b/i.test(p)) s=Math.max(0,s-2);
      return s;
    }
    // Phishing spotter
    $('#phishBtn').addEventListener('click', ()=>{
      $('#phishOut').textContent = 'Looks phishing! 🚫 Don’t click. Use the official app/site and ask a trusted adult.';
    });

    // ===== Chat (unchanged backend call) =====
    const chatLog = $('#chatLog'); const chatForm = $('#chatForm'); const chatInput = $('#chatInput');
    $$('input[name="age"]').forEach(r=>r.addEventListener('change',()=>ageGroup=r.value));

    function containsPII(t){
      const email=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/i;
      const phone=/(\+?\d{1,2}[\s.-]?)?(KATEX_INLINE_OPEN?\d{3}KATEX_INLINE_CLOSE?[\s.-]?)\d{3}[\s.-]?\d{4}\b/;
      const address=/\b\d{1,5}\s+\w+(?:\s+\w+){0,3}\s+(street|st|avenue|ave|road|rd|boulevard|blvd|lane|ln|drive|dr|court|ct)\b/i;
      const school=/\b(school|elementary|middle\s+school|high\s+school|academy|ps\s?\d+)\b/i;
      const password=/\bpassword\b\s*[:=]\s*\S+/i;
      const username=/\b(user(name)?|login)\b\s*[:=]\s*\S+/i;
      return email.test(t)||phone.test(t)||address.test(t)||school.test(t)||password.test(t)||username.test(t);
    }
    function addUser(t){ const b=document.createElement('div'); b.className='bubble user'; b.textContent=t; chatLog.appendChild(b); chatLog.scrollTop=chatLog.scrollHeight; }
    function addSpark(t){ const b=document.createElement('div'); b.className='bubble spark'; b.textContent=t; chatLog.appendChild(b); chatLog.scrollTop=chatLog.scrollHeight; }
    function addTyping(){ const b=document.createElement('div'); b.className='bubble spark'; b.innerHTML='<span class="typing"><span></span><span></span><span></span></span>'; b.dataset.t='1'; chatLog.appendChild(b); chatLog.scrollTop=chatLog.scrollHeight; }
    function removeTyping(){ const last=[...chatLog.querySelectorAll('.bubble.spark')].reverse().find(x=>x.dataset.t==='1'); if(last) last.remove(); }

    chatForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const text = chatInput.value.trim(); if(!text) return;
      if(containsPII(text)){ addSpark("Let’s keep personal info private 👍 Please don’t share your real name, address, phone number, school, email, or passwords. You can ask me about staying safe online, like passwords, privacy, bullying, or games! 🌟"); chatInput.value=''; return; }
      addUser(text); chatInput.value=''; addTyping();
      try{
        const res = await fetch(BACKEND_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ message:text, ageGroup })});
        const data = await res.json(); removeTyping();
        if(data.ok) addSpark(data.reply || 'Thanks for your message! 😊'); else addSpark(data.error || 'Oops, I had trouble replying. Please try again.');
      }catch{ removeTyping(); addSpark('Network error. Please try again in a moment.'); }
    });

    // ===== Game: Runner =====
    const cvs = $('#runner'); const ctx = cvs.getContext('2d');
    const startBtn = $('#startBtn'), pauseBtn = $('#pauseBtn'), resetBtn = $('#resetBtn');
    const scoreEl = $('#score'), hiEl = $('#hi'), livesEl = $('#lives');
    let running=false, paused=false, score=0, hi=Number(localStorage.getItem('ss-hi')||0), lives=3, t=0, speed=4, g=0.9, vy=0, y=0, onGround=true;
    const H = cvs.height, W = cvs.width, ground = H-40;
    const obstacles = []; const stars=[];
    const tips = [
      'Don’t share passwords!',
      'Check links before you click!',
      'Be kind; block/report meanness!',
      'Ask a trusted adult if unsure!'
    ];
    const bads = ['🎣','😡','🔗','📸'];

    function resetGame(){ running=false; paused=false; score=0; lives=3; speed=4; t=0; vy=0; y=ground; onGround=true; obstacles.length=0; stars.length=0; updateHUD(); draw(); }
    function updateHUD(){ scoreEl.textContent=score; hiEl.textContent=hi; livesEl.textContent=lives; }

    function drawGround(){ ctx.fillStyle='#FFE9B6'; ctx.fillRect(0,ground+20,W,4); ctx.fillStyle='#FFF6D8'; ctx.fillRect(0,ground+24,W,H-ground-24); }
    function drawPlayer(){
      // shielded runner
      ctx.save();
      const x=70;
      ctx.translate(x, y);
      // body
      ctx.fillStyle='#E63946'; ctx.fillRect(-15,-30,30,30);
      // face
      ctx.fillStyle='#fff'; ctx.fillRect(-13,-28,26,10);
      ctx.fillStyle='#1d1d1f'; ctx.fillRect(-9,-25,6,6); ctx.fillRect(3,-25,6,6);
      // feet
      ctx.fillStyle='#C1121F'; ctx.fillRect(-14,0,12,6); ctx.fillRect(2,0,12,6);
      ctx.restore();
    }
    function rand(a,b){ return Math.random()*(b-a)+a; }

    function spawn(){
      if(t%Math.max(40, 100 - speed*8)===0){
        obstacles.push({x:W+30,y:ground, w:28, h:26, k:bads[Math.floor(Math.random()*bads.length)], tip: tips[Math.floor(Math.random()*tips.length)]});
      }
      if(t%150===0){ stars.push({x:W+30, y:ground-60-Math.random()*40, r:10}); }
    }

    function update(){
      if(!running || paused) return;
      t++; score+=1; if(score%300===0) speed=Math.min(speed+0.5,10);
      // gravity
      if(!onGround){ vy+=g; y+=vy; if(y>=ground){ y=ground; vy=0; onGround=true; } }
      // move obstacles
      for(const o of obstacles){ o.x-=speed; }
      for(const s of stars){ s.x-=speed*0.9; }
      // collisions
      obstacles.forEach((o,i)=>{
        if(o.x<-40) obstacles.splice(i,1);
        const px=70, py=y-30, pw=30, ph=36;
        if(px < o.x+o.w && px+pw > o.x && py < o.y && py+ph > o.y-o.h){
          // hit
          obstacles.splice(i,1);
          lives--; addOverlayTip(o.tip);
          if(lives<=0){ gameOver(); return; }
        }
      });
      stars.forEach((s,i)=>{
        if(s.x<-20) stars.splice(i,1);
        const dx = 70 - s.x, dy = (y-24) - s.y;
        if(Math.hypot(dx,dy) < 22){ score+=50; stars.splice(i,1); }
      });
      updateHUD(); draw();
      requestAnimationFrame(update);
    }

    function draw(){
      ctx.clearRect(0,0,W,H);
      drawGround();
      // stars
      ctx.fillStyle='#FFD166';
      stars.forEach(s=>{
        ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
      });
      // obstacles
      obstacles.forEach(o=>{
        ctx.font='24px system-ui'; ctx.fillStyle='#2b2b2b'; ctx.fillText(o.k, o.x, o.y-2);
      });
      drawPlayer();
    }

    function jump(){
      if(!running || paused) return;
      if(onGround){ vy=-14; onGround=false; }
    }

    function gameOver(){
      running=false; paused=false;
      hi = Math.max(hi, score); localStorage.setItem('ss-hi', String(hi)); updateHUD();
      confetti();
      ctx.save();
      ctx.fillStyle='rgba(255,255,255,.85)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle= '#C1121F'; ctx.font='bold 28px Nunito'; ctx.fillText('Great run! Final score: '+score, 230, 120);
      ctx.fillStyle= '#7a161c'; ctx.font='bold 18px Nunito'; ctx.fillText('Press Start to try again.', 310, 160);
      ctx.restore();
    }

    function addOverlayTip(text){
      const tip=document.createElement('div');
      tip.className='pill'; tip.style.position='absolute'; tip.style.left='12px'; tip.style.top='12px';
      tip.textContent=text; $('.game-card').appendChild(tip);
      setTimeout(()=>tip.remove(), 1600);
    }

    startBtn.addEventListener('click', ()=>{
      if(running && !paused) return;
      if(!running){ resetGame(); running=true; requestAnimationFrame(update); }
      paused=false;
    });
    pauseBtn.addEventListener('click', ()=>{ if(running){ paused=!paused; if(!paused) requestAnimationFrame(update); } });
    resetBtn.addEventListener('click', resetGame);
    document.addEventListener('keydown', e=>{ if(e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); jump(); } });

    // ===== Confetti =====
    function confetti(){
      const wrap = $('#confetti');
      for(let i=0;i<26;i++){
        const c=document.createElement('div');
        c.className='confetti'; c.textContent = ['⭐','✨','🌟'][Math.floor(Math.random()*3)];
        c.style.left = Math.random()*100+'vw';
        c.style.top = '-10px'; c.style.animationDelay = (Math.random()*0.5)+'s';
        c.style.transform = `scale(${0.7+Math.random()*0.8})`;
        wrap.appendChild(c); setTimeout(()=>c.remove(), 2000);
      }
    }

    // ===== Init =====
    function init(){
      renderModules(); updateStars(); updateProgress(); draw();
      $('#hi').textContent = hi;
    }
    init();
  </script>
</body>
</html>
